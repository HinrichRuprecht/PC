<head>
<title>DKhelp</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="copyright" content="H. Ruprecht" />
</head>
<h1>Kartenspiele mit Trumpf und Stichen</h1>
<h3><a href="https://de.wikipedia.org/wiki/Bridge_%28Kartenspiel%29#"
    target="_blank" rel="noopener noreferrer">Bridge</a>
    <img src="../PC/img/Bridge.png" width=20 height=20 border=0>
    &nbsp;
    <a href="https://de.wikipedia.org/wiki/Doppelkopf" target="_blank"
	rel="noopener noreferrer">Doppelkopf</a>
    <img src="../PC/img/Doppelkopf.png" width=20 height=20 border=0>
    &nbsp;
    <a href="https://de.wikipedia.org/wiki/Stiche-Raten" 
    target="_blank" rel="noopener noreferrer">Stiche-Raten (Teufelsskat)</a>
    <img src="../PC/img/OhHell.png" width=20 height=20 border=0>
  </h3>
<!--

-->
<h3>Allgemeine Hinweise</h3>
Damit es überhaupt losgehen kann, muss ein virtueller Tisch vorbereitet sein. Die Anmeldung erfolgt dann über <i>webpage</i>/PC/PC.html, optional mit 
angehängtem ?P=TISCH-NAME, ansonsten wird nach TISCH und NAME gefragt. Der Tisch
muss als Datei vorbereitet sein, der Spielername ist frei wählbar. <br>
Die Symbole für die Karten und Funktionen sollten selbsterklärend sein.  Wenn man mit der Maus drüber geht, wird dazu auch ein Erklärtext angezeigt.<br>
Die Karten werden durch den Browser (Firefox, Chrome, ...) als Zeichen (
<a href="https://de.wikipedia.org/wiki/Unicodeblock_Verschiedene_Symbole">UTF
</a>
) oder als Bild dargestellt. Die Bilder entsprechen den englischen Bezeichnungen, 
also Bube=J (&#x1f0ab; Jack), Dame=Q (&#x1f0ad; Queen). Die Symbole für 
Damen- und Buben-Solo (&#x265B;&#x265D;) beim Doppelkopf sind eigentlich
Schachfiguren.<br>
Auf Android-Smartphones und -Tablets wird i.a. ein anderer Font benutzt, der die Karten "genauer" abbildet. Wer damit Schwierigkeiten hat, kann auf die Bilddarstellung umschalten.<br>
Mit Klick auf die Karte links oben wird zwischen Zeichen- und verschiedenen
Bilddarstellungen für die Karten und Symbole umgeschaltet.<br>
Dieser Text wird mit Klick auf das i-Symbol (&#x1F6C8; rechts unten)
angezeigt.<br>
Der erste angemeldete Spieler erhält oben ein grünes Hakensymbol &#x2611;, 
mit dem er das Verteilen der Karten starten kann. Auch das eigentliche Spielen
nach einer Ansagerunde wird damit gestartet. <br>
Vorm Verteilen der ersten Karten werden die Plätze zufällig verteilt.  Spieler, die sich später anmelden, werden "hinten" angehängt und beim nächsten
Kartenverteilen berücksichtigt. 
Siehe auch <a href="#manuell">Manuelle Eingriffe</a>.<br>
Für die Kommunikation mit den anderen Spielern wird mit Klick auf das Jitsi-Symbol (oben links) eine <a href="#video">Videokonferenz</a> gestartet.<br>

<h3>Bildschirm-Layout</h3>
Der Bildschirm wird für den jeweiligen Spieler so angeordnet, dass seine Karten
unten stehen. <br>
Es gibt klickbare Symbole fürs 'neu laden' (runder Pfeil &#x27F3;), sowie Spiel-spezifische Symbole, z.B. bei Doppelkopf Vorbehalt &#x26A0;, ... und ggf. ein
Symbol fürs Sortieren, mit dem die Symbole zum Sortieren der Karten gezeigt werden.<br>
Rechts oben stehen Statusanzeigen für die Spieler, gewonnene Stiche und Punkte,
<a href="#ansagen">Ansagen</a> sowie der letzte Stich.
<br>
Im mittleren Bereich werden die bisherigen Karten des Stichs angezeigt. Ein '?'  und eine farbliche Markierung beim Spielnamen (oben rechts) zeigen an, wer gerade dran ist.<br>
Dazu kommen Mitteilungen für alle und für den Spieler sowie Symbole für Ansagen (nächster Abschnitt).<br>
Siehe auch <a href="#SpieltischJitsi">Spieltisch und Jitsi</a>.

<h3 id="ansagen">Ansagen</h3>
Bei jedem Spiel ist die "nullte" Runde für Ansagen reserviert. D.h. man klickt auf die entsprechenden Symbole, deren Bedeutung angezeigt wird, wenn man 
mit der Maus darauf steht. Das Hand-Symbol &#x261E; bedeutet passe/Verzicht.<br>
Wenn die Ansagen geklärt sind, wird mit Klick auf das ok-Symbol (Haken &#x2611;) 
gestartet. <br>
Nach der Ansagerunde beginnt das Spiel, und es können ggf. noch Punkte-relevante Absagen gemacht werden. <br>
<i>Sonderfälle bei Doppelkopf</i>:<br>
Bei Armut &#x2639; werden die Trümpfe automatisch für den Tausch bereitgestellt.
Ggf. muss um Nicht-Trümpfe ergänzt werden. Die folgenden Spieler müssen dann per
weiter-Symbol (Hand &#x261E;) verzichten oder mit dem blauen Smiley &#x263A; 
annehmen.<br>
Spieler mit mindestens 5 Neunen (bzw. Königen beim Spiel ohne Neunen) erhalten
ein Recycling-Symbol &#x267A;, mit dem sie neue Karten anforden können.<br>

<h3>Spielverlauf</h3>
Es wird wie beim "richtigen" Spiel der Reihe nach gespielt. Wer zu früh spielt 
oder falsch bedient, wird darauf hingewiesen.<br>
Fehleingaben (versehentlich falsches Symbol geklickt) können vom "ersten" Spieler mit Klick auf den Links-Pfeil &#x2B05; rückgängig gemacht werden. Danach ist im allgemeinen bei allen ein Neuladen (runder Pfeil &#x27F3; auf der rechten Seite)
erforderlich.
<br>
Wenn alles nichts hilft, geht auch Str-R.<br>

<h3>Ende eines Spiels</h3>
Das Programm zählt die Anzahl Stiche, addiert ggf. Kartenwerte und rechnet Punkte (zurzeit nicht für Bridge) aus. Mit Klick auf den ok-Haken &#x2611; wird das nächste Spiel gestartet.<br>
<!--Bei Doppelkopf ist die Freigabe fürs nächste Spiel mit einer Abfrage
verbunden, über die Punkte manuell eingegeben werden können. Vorgabe sind die berechneten Punkte.<br>
-->

<h3 id="video">Videokonferenz</h3>
Mit Klick auf das Jitsi-Symbol wird eine Jitsi-Videokonferenz gestartet.<br>
Die Anzeigebereiche im Spielfenster rücken dann zur Seite bzw. nach unten, sodass das Jitsi-Fenster das Spielfenster überlagern kann. Siehe auch der Abschnitt zu <a href="#SpieltischJitsi">Spieltisch und Jitsi</a>.<br>
Um alle Mitspieler zu sehen, sollte man im rechten unteren Bereich des 
Jitsi-Fensters die Kachelansicht wählen. <br>
Erneutes Klicken des Jitsi-Symbols bringt den Spieltisch wieder in die Mitte 
des Fensters. Bei "integriertem" Jitsi überlagern die Karten den Jitsi-Bereich,
bei separatem Jitsi-Fenster kann man das verkleinerte Spielfenster neben das
Jitsi-Fenster positionieren.<br>
Tipp: Mit Str/- rücken die Kacheln dichter zusammen und werden größer.<br>
Falls es mal mit der Videokonferenz nicht klappt, kann auch über das 
Chat-Feld (Tastatursymbol &#x1F5AE;) kommuniziert werden.<br>
Der Name des Jitsi-Raumes kann in der Spielstatusdatei (Variable JitsiRoom.X) 
oder auch vom Master-Spieler <a href="#manuell">manuell</a> festgelegt werden.
Ansonsten wird ein Raumname generiert.

<h3 id="SpieltischJitsi">Anzeige von Spieltisch und Jitsi-Fenster</h3>
Für die Verwendung bei Smartphones und Tablets <a href="#smart">hier</a>
klicken.<br>
Für den Start des Jitsi-Fensters gibt es mehrere Möglichkeiten.<br>
Eine Integration ins Spielfenster ist nur bei verschlüsselter Übertragung 
möglich. D.h. bei Aufruf des Spiels über https:// erscheint bei Klick aufs 
Jitsi-Symbol ein in die Spielseite integrierter Jitsi-Rahmen.<br>
Ohne https: (Spielstart nur mit http://) wird versucht ein PopUp-Fenster zu 
öffnen, was vom Browser nicht blockiert werden darf.<br>
Alternativ kann man die Abfrage 'abbrechen' und unten rechts den Jitsi-Link
mit rechter Maustaste klicken. Dann kann explizit Tab oder neues Fenster
gewählt werden.<br>
Wenn Spielfeld und Jitsi eigene Tabs im selben Browser-Fenster haben, kann man 
mit linker Maustaste einen der Tab-Titel fest klicken und dann verschieben (oder
rechts-Klick -> verschieben - in neues Fenster).
Dadurch wird aus dem Tab ein neues Fenster.
Der Browser darf dazu nicht im Vollbildmodus sein, also -> 'verkleinern'
(&#x2750;)!<br>
Anschließend Fenster verschieben (Festklick auf Titelzeile + ziehen) 
oder Größe ändern : Maus auf Rand bis <> (&#x02194;) erscheint, dann Festklick + ziehen.<br>

<h3 id="smart">Smartphones und Tablets</h3>
Eigentlich sollte auch hier die Integration in den Browser funktionieren, aber 
zumindest beim iPad ist es nicht so einfach.<br>
Am besten soll es mit dem Google-Chrome-Browser gehen, aber "expect issues" 
heißt es bei den Jitsi-Entwicklern (siehe oben).<br>
Ansonsten kann man bei IOS (iPad) und Android zunächst die (installierte) 
Jitsi-App starten (direkt oder indirekt mit Klick auf einen Jitsi-Link für den Jitsi-Raum der Statusdatei).<br>
Wenn die Videokonferenz dann läuft, muss man über den Home-Button (oder wischen, 
um die verfügbaren Apps anzuzeigen) einen Browser starten, in dem dann der 
Link zum Spiel eingegeben oder geklickt wird. Das Jitsi-Fenster sollte dann in
einer Ecke das Browser-Fenster überlagern. Man sieht also beide. <br>
Das Jitsi-Fenster kann man (vermutlich) mit Festklick verschieben.  Wenn man dann
den Jitsi-Aladin im Spielfenster klickt, rücken die Karten und Symbole zur Seite.
Weil Jitsi ja dann schon läuft, sollte man den zusätzlichen Start 'abbrechen'.
<br>
Erneutes Klicken auf den Aladin rückt ggf. alles wieder an die alten Stellen.<br>

<h3 id="manuell">Manuelle Eingriffe</h3>
Mit dem roten Pfeil (&#x2B05;) hat der "erste" Spieler die Möglichkeit, einen
Schritt zurückzunehmen. <br>
Außerdem gibt es die Möglichkeit, in die Spieldatei einen "Master"-Spieler
einzutragen. 
Jemand, der sich mit diesem Namen anmeldet hat, hat zusätzliche Klick-Symbole
und kann über das Chat-Feld (&#x1F5AE;) Variablen setzen, die den weiteren
Ablauf steuern.<br>
<b>Die Variablen müssen gesetzt sein bevor sie benutzt werden!</b><br>
Beispiele: (Spieler sind in der Liste rechts oben ab 1 nummeriert) <br>
<ol style="list-style-type:square">
  <li>Spieler 3 und 4 pausieren: <tt> > PAUSED : 34 </tt><br>
    (die Spielernamen werden dann <i>schräg</i> gestellt. </li>
  <li>alle spielen wieder mit:<tt> > PAUSED : </tt> (<i>leer</i>) </li>
  <li>Spieler 3 soll rauskommen:<tt> > N : 3</tt>  und<tt> > X : 3 </tt><br>
    (N : nächster Spieler, X : beginnt den Stich)</li>
  <li>Reihenfolge am Tisch für aktuelle Karten ändern:<tt> > POS : 3214 </tt><br>
    (dauerhafte Änderung über Positions-Button &#x1F522;)</li>
  <li>Jitsi-Raum festlegen:<tt> > JitsiRoom : </tt><i>irgendwaseindeutiges</i>
    </li>
  <li>ohne Neunen:<tt> > cardSequence : A1KQJ</tt><br>
    (die Eingabe muss vorm Anmelden des letzten Spielers erfolgen)</li>
  <li>2. Herz-10 geht NICHT über die erste :<tt> > rules : 3J,2A,Dk,Rd</tt><br>
    (3J=Kreuz-Bube=Karĺchen, 2A=Fuchs, Dk=Doppelkopf, 
	Rd=neu geben (5 Neunen, 3 bzw. 5 Könige), 11=Herz-10)</li>
</ol>

<h3>Hintergrundinformation</h3>
Das Spielprogramm besteht aus 2 Teilen. Zum einen dem html-Teil (PC.html), der die Darstellung, Plausibilitätsprüfungen und die Jitsi-Einbindung übernimmt.
Dieser Teil läuft im Browser des Spielers.<br>
Jedes PC.html startet bei jedem Klick ein Perl-Programm (PC.pl) auf dem 
PC-Server, das über alle Aktionen in einer Statusdatei Buch führt und auf
Änderungen durch die anderen lauert, um diese den anderen Spielern mitzuteilen.
Außerdem werden bei Bedarf neue Karten verteilt, und es werden Kartenpunkte gezählt, auf richtiges Bedienen geprüft, entschieden, wer den Stich bekommt,
...<br>
Das Serverprogramm (PC.pl) versucht zunächst, sich an ein laufendes Exemplar des
Programms im Server-Modus anzuhängen. Dieses kennt alle Zustände
(Karten, Ansagen, Punkte) der Spieler und kann die Anforderungen ohne erneutes
Lesen der Statusdatei bedienen. Dieses Programm muss auf dem Spielserver
vorher gestartet worden sein.<br>
Ansonsten muss es selbst mit der Statusdatei arbeiten und ggf. immer wieder
nachsehen, ob sich etwas geändert hat ('busy wait'). Es gibt dadurch immer 
kleine Verzögerungen. Es sollte also möglichst das Server-Programm gestartet
werden.<br>
Zurzeit (Testphase) erfolgt die Kommunikation mit dem Server über Tischnamen
und Spielernamen (Namenskürzel). Damit sich niemand unbemerkt den Stand eines anderen Spielers ansehen kann, ist eine Kommunikation über zufällig erzeugte Ids vorgesehen. Die Testphase kann in der Spielestatusdatei an-/abgestellt
werden.<br>
Maßnahmen die verhindern, dass der Server-Betreiber Einsicht in die Daten hat, zum Beispiel Verschlüsselung der Daten, sind zurzeit nicht vorgesehen.<br>
Damit es überhaupt losgehen kann, muss auf dem PC-Server eine Datei mit Anfangswerten existieren und ggf. per Reset auf Anfangswerte zurückgesetzt 
werden. Bei Eigenbedarf bitte bei mir melden.<br>
Das Serverprogramm (PC.pl) benutzt ein Perl-'package' für die allgemein bei 
Kartenspielen mit Stichen und Trümpfen benötigten Teile und je ein 'package' 
mit den Besonderheiten des Spiels (Bridge, Doppelkopf, Stiche-Raten).<br>

<i>© 2020-2021 H. Ruprecht : benutzbar entsprechend GNU public license</i>
