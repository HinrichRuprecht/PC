<head>
<title>DKhelp</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="copyright" content="H. Ruprecht" />
</head>
<h1>Trick-Taking Card Games</h1>
<h3><a href="https://en.wikipedia.org/wiki/Contract_bridge#"
    target="_blank" rel="noopener noreferrer">Bridge</a>
    <img src="../PC/img/Bridge.png" width=20 height=20 border=0>
    &nbsp;
    <a href="https://en.wikipedia.org/wiki/Doppelkopf" target="_blank"
	rel="noopener noreferrer">Doppelkopf</a>
    <img src="../PC/img/Doppelkopf.png" width=20 height=20 border=0>
    &nbsp;
    <a href="https://en.wikipedia.org/wiki/Oh_Hell" 
    target="_blank" rel="noopener noreferrer">Oh Hell</a>
    <img src="../PC/img/OhHell.png" width=20 height=20 border=0>
  </h3>

<h3>General information</h3>
A virtual table must be prepared so that things can start. You can then register via <i>webpage</i>/PC/<i>PC.html</i>, optionally with ?P=TABLE-NAME. Otherwise you will be asked for TABLE and NAME. The table must exist as a file, the player name can be freely chosen.<br>
The buttons for the cards and functions should be self-explanatory. If you put the mouse over it, an help text is displayed.<br>
The cards are displayed by the browser (Firefox, Chrome, ...) as characters 
(<a href="https://en.wikipedia.org/wiki/Miscellaneous_Symbols">UTF</a>) or as an image. The cards correspond to the English names, i.e. Jack = J (&#x1f0ab; Jack), Queen = Q (&#x1f0ad; Queen). The buttons for queen and jack solos (&#x265B;&#x265D;) on Doppelkopf are actually chess symbols.<br>
On Android smartphones and tablets, a different font is used, which depicts the cards "more precisely". If you have difficulties with this, you can switch to image display.<br>
By clicking on the card at the top left, you can toggle between character and various image representations for the cards and buttons.<br>
This text is displayed by clicking on the i button (&#x1F6C8; bottom right).<br>
The first registered player receives a green tick button &#x2611; at the top, which allows to start the distribution of the cards. It also starts the actual game after an announcement round.<br>
Before the first cards are distributed, the seats are distributed randomly. Players who register later will be added "at the end" and are taken into account the next time cards are dealt. See also <a href="#manual">manual intervention</a>.<br>
To communicate with the other players, a <a href="#video">video conference</a> is started by clicking on the Jitsi button (top left).

<h3>Screen layout</h3>
The screen is arranged for the respective player so that his/her cards are at the bottom.<br>
There are buttons for 'reloading' (round arrow &#x27F3;), as well as game-specific buttons, eg with Doppelkopf a reservation button &#x26A0;, and buttons used for sorting in solo games.<br>
At the top right there are status displays for the players, tricks and points won, <a href="#announcements">announcements</a> and the last trick.<br>
The current cards of the trick are displayed in the middle area. A '?' and a colored mark next to the player name (top right) shows who is currently playing.<br>
There are also messages for everyone and for the player as well as buttons for announcements (next section).<br>
See also <a href="#gameTableJitsi">gaming table and jitsi</a>.

<h3 id="announcements">Announcements</h3>
In every game, round zero is reserved for announcements. This means that you click on the corresponding buttons, the meaning of which is displayed when you position the mouse over them. The hand button &#x261E; means pass / waiver.<br>
When the announcements have been clarified, click on the ok button (tick &#x2611;) to start.
After the announcement round, the game begins and points-relevant bids can be made if necessary.<br>
<i>Special cases with Doppelkopf</i>:<br>
In the case of poverty &#x2639;, the player's trump cards are automatically made available for the exchange. It may be necessary to add non-trump cards. The following players must then waive with the continue button (hand &#x261E;) or accept with the blue smiley &#x263A;.<br>
Players with at least 5 nines (or kings in the game without nines) receive a recycling button &#x267A; used to request new cards.<br>

<h3>Course of the game</h3>
It is played in sequence as in the "real" game. This will be pointed out to anyone who plays too early or serves incorrectly.<br>
Incorrect entries (accidentally clicking the wrong button) can be undone by the "first" player by clicking on the left arrow &#x2B05;. After that, generally all players have to reload (round arrow &#x27F3; on the right-hand side).<br>
If everything else fails, Ctl R should work.<br>

<h3>End of a game</h3>
The program counts the number of tricks, adds card values ​​if necessary, and calculates points (currently not for bridge). The next game is started by clicking on the ok tick &#x2611;.

<h3 id="video">Video conference</h3>
Click on the Jitsi button to start a Jitsi video conference.<br>
The display areas in the game window then move to the side or down so that the Jitsi window can overlay the game window. See also the section on <a href="#gameTableJitsi">gaming table and jitsi</a>.<br>
In order to see all players, you should select the tile view in the lower right area of ​​the Jitsi window.<br>
Clicking the Jitsi button again brings the gaming table back to the center of the window. With "integrated" Jitsi, the cards overlay the Jitsi area; with a separate Jitsi window, the reduced game window can be positioned next to the Jitsi window.<br>
Tip: With Ctl - the tiles move closer together and get larger.<br>
If the video conference does not work, you can also use the chat field (keyboard button &#x1F5AE;) to communicate.<br>
The name of the Jitsi room can be specified in the game's status file (variable JitsiRoom.X) or manually by the master player.  Otherwise the room name will be generated by the server program.<br>

<h3 id="gameTableJitsi">Display of gaming table and Jitsi window</h3>
Click <a href="#smart">here</a> for the usage on smartphones and tablets.<br>
There are several options for starting the Jitsi window.
Integration into the game window is only possible with encrypted transmission. This means that when you start the game via https:// a click on the Jitsi button displays a Jitsi frame integrated into the game page.<br>
Without https: (game start with http://) an attempt is made to open a popup window, which the browser must not block.<br>
Alternatively, you can 'cancel' the query and right-click the Jitsi link at the bottom right. Then you can explicitly select tab or new window.<br>
If game and Jitsi have their own tabs in the same browser window, you can firmly left-click one of the tab titles and then move it (or right-click -> move - to a new window). This will open a new window for the tab. The browser must not be in full screen mode, so 'reduce' (&#x2750;)!
Then move the window (click on the title line + drag) or change its size: mouse on the border until <> (&#x02194;) appears, then click + drag.<br>

<h3 id="smart">Smartphones and tablets</h3>
The integration into the browser should actually work here too, but at least with the iPad it is not that easy.<br>
The Google Chrome browser is recommended, but the Jitsi developers say "expect issues" (see above).<br>
Otherwise, you can first start the (installed) Jitsi app on IOS (iPad) and Android (directly or indirectly by clicking on a Jitsi link using the Jitsi room specified in the status file).<br>
When the video conference is running, start a browser via the home button (or swipe to display the available apps), in which the link to the game is then entered or clicked. The Jitsi window should then overlay the browser window in one corner. So you can see both.<br>
The Jitsi window can (presumably) be moved using a firm click. If you then click the Jitsi-Aladin in the game window, the cards and buttons move to the side. Because Jitsi is already running then, you should 'abort' the additional start.<br>
Clicking on the Aladin again may move everything back to its old positions.

<h3 id="manual">Manual intervention</h3>
The "first" player gets a red arrow (&#x2B05;), which is used to take a step back.<br>
There is also the option of entering a "master" player in the game file. Someone who has registered with this name has additional buttons and can use the chat field (&#x1F5AE;) to set variables that control the further process 
(<tt> > VARIABLE : VALUE </tt>).<br>
The variables must be set before they can be used!<br>
Examples: (Players are numbered from 1 in the list at the top right)<br>
<ol style="list-style-type:square">
<li>Player 3 and 4 pause: <tt>> PAUSED: 34</tt><br>
    (player names are displayed in <i>italics</i>.</li>
<li>everyone is playing again: <tt>> PAUSED: </tt>(<i>empty</i>)</li>
<li>player 3 to serve: <tt>> N : 3</tt> and <tt>> X : 3</tt><br>
    (N : next player, X : next to serve)</li>
<li>change order of players for next cards: <tt>> POS : 3214</tt><br>
    (use positions button &#x1F522; for permanent change)</li>
<li>set Jitsi room name: <tt>> JitsiRoom : <i>somethingUnique</i></tt></li>
<li>w/o nines: <tt>> cardSequence : A1KQJ</tt><br>
    (must be set before the last player registers)</li>
<li>2nd 10 of hearts is NOT higher than 1st : <tt>> rules : 3J,2A,Dk,Rd</tt><br>
    (3J=Jack of clubs=Karĺchen, 2A=fox, Dk=Doppelkopf, Rd=new cards (with 5 nines, 3 or 5 kings), 11=10 of hearts)</li>
</ol>
    
<h3>Background information</h3>
The game program consists of a client and a server part. The client part (<i>PC.html</i>) does the presentation, plausibility checks and the Jitsi integration. This part runs in the player's browser.<br>
With every click <i>PC.html</i> starts a Perl program (<i>PC.pl</i>) on the web server, which handles all actions and keeps a record of them in a status file. Also, new cards are distributed if necessary, card points are counted, correct operation is checked, it is decided who gets the trick, etc.<br>
The server program (<i>PC.pl</i>) first tries to attach itself to a running copy of the program in server mode. This knows the whole status (cards, announcements, points) of the players and can serve the requirements without having to read the status file again. This program must have been started on the game server beforehand.<br>
Otherwise <i>PC.pl</i> works in client mode, i.e. it has to work with the status file itself and, if necessary, check again and again whether something has changed ('busy wait'). As a result, there are always small delays. If possible, the server program should be started in server mode.<br>
At the moment (test phase) communication with the server takes place via table names and player names (name abbreviations). Communication via randomly generated IDs is provided so that nobody can look at the status of another player unnoticed. The test phase can be switched on / off in the game status file.<br>
Measures that prevent the server operator from viewing the data, for example encryption of the data, are currently not provided.<br>
In order to get started, a file with initial values ​​must exist on the PC server and, if necessary, reset to initial values. Template files for every game are provided.<br>
The server program (<i>PC.pl</i>) uses one Perl 'package' <i>PC.pm</i> for the parts generally required in card games with tricks and trumps, and a 'package' for each game (<i>Bridge.pm, Doppelkopf.pm, OhHell.pm</i>) with the game-specific features.<br>
<br>
<i>© 2020-2021 H. Ruprecht: usable according to GNU public license</i>
